<%-include('../innerHeader')%>

<section class="heading-sec">
	<div class="container">
		<div class="row align-item-center">
			<div class="col-lg-6 col-md-6 col-sm-6">
				<div class="main-heading-dash">
					<img src="../assets/images/icons/verifier-home-assets/manage-sub-verifiers.png">
					<h4>Sub-Verifiers List</h4>
				</div>
			</div>
			<div class="col-lg-6 col-md-6 col-sm-6">
				<div class="text-right">
					<a class="btn-common-new" href="" data-toggle="modal" data-target="#add-new-sub-verifier-Modal">Add New Sub-Verifier</a>
				</div>
			</div>
		</div>
	</div>
</section>

<section>
	<div class="container">
		<div class="row">

			<% if(err_msg!=undefined && err_msg !='' ){ %>
				<div class="alert alert-danger text-center  flash_msg ">
						<%= err_msg %>
					 </div>
			   
				<% }%>
			   <% if(success_msg!=undefined && success_msg !='' ){ %>
				  <div class="alert alert-success text-center  flash_msg ">
					<%= success_msg %>
				 </div>
				<% }%>
			<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
				<div class="row personal-info-heading mt-0 mb-0 align-items-end">
					<div class="col-xl-6  col-lg-12 col-md-12 col-sm-12">
					  <div class="custom-space-btw for-flex-remove  another-drop-down  align-items-end">
						<div class="for-two-select-in-one mb-0">  
							<div class="for-select-existing-doc">
							    <div class="input-group">
									<div class="dropdown keep-inside-clicks-open">
										<h3 class="small-title">Status</h3>
										<button class="dropdwn-btn" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
										    All
										</button>
										<div class="dropdown-menu" aria-labelledby="dropdownMenuButton" x-placement="bottom-start">
										    <div class="for-doc-select">
										    	<div class="checkbox"> 	
										        	<label>
										          		All
										            	<input type="checkbox" value="">
										            	<span class="cr"><i class="cr-icon fa fa-check"></i></span>
										          	</label>
										        </div>	
										    </div>
										    <div class="for-doc-select">
										    	<div class="checkbox"> 	
										         	<label>
											          	Active
											            <input type="checkbox" name="statusfilter" value="'active'" class="checkbox2">
											            <span class="cr"><i class="cr-icon fa fa-check"></i></span>
										          	</label>
										        </div>	
										    </div>
										    <div class="for-doc-select">
										    	<div class="checkbox"> 	
										         	<label>
											          	Deactive
											            <input type="checkbox" name="statusfilter" value="'inactive'" class="checkbox2">
											            <span class="cr"><i class="cr-icon fa fa-check"></i></span>
										          	</label>
										        </div>	
										    </div>
										</div>
									</div>
								</div>
							</div>
						</div>
					  </div>
					</div>
					<div class="col-xl-6  col-lg-12 col-md-12 col-sm-12 custom-flex-row for-mobile-search">
						<form class=" response-search"> 
		                     <div class="input-group search-address-book">
		                        <input type="text" class="form-control autocomplete" id="myInput" placeholder="Search" onkeyup="globalSearch(value);">
		                        <div class="input-group-append">
		                            <button class="btn btn-search" type="button"><img src="../assets/images/icons/search-black.png"></button>
		                        </div>
		                    </div>
	                  	</form>
						<div class="text-right">
							<a href="javascript:void(0)" onclick="downloadpenlist()">
								<div class="icon-for-dwnload">
									<div class="tooltip fade" data-title="Export Data">
										<img src="../assets/images/icons/dashboard-assets/export.png">
										 <img class="info-icon" src="../assets/images/icons/dashboard-assets/info-icon.png">
									</div>
									
								</div>
							</a>
							<a class="nodata" id="" onclick="printpendiv()">
								<div class="icon-for-dwnload">
									<div class="tooltip fade" data-title="Print Data">
										<img src="../assets/images/icons/dashboard-assets/print.png">
										<img class="info-icon" src="../assets/images/icons/dashboard-assets/info-icon.png">
									</div>
								</div>
							</a>
						</div>
					</div>
				</div>

				<!-- Button S-->
				<div class="text-right">
					<div class="btn-all-dwnload">
						<a href="/sub_verfier_my_client"><img src="../assets/images/icons/dashboard-assets/icon_eye_pur.png"> View Details</a>
						<a href="javascript:checkedChangeStatus('deactivate')"><img src="../assets/images/icons/verifier-home-assets/reject.png"> Deactivate </a>
						<a href="javascript:checkedChangeStatus('delete')"><img src="../assets/images/icons/verifier-home-assets/delete.png"> Delete</a>
					</div>
				</div>
				<!-- Button E -->
				<div class=" table-responsive mt-30 table-dash" id="tablefilterid">
					<table class="table" id="myTable3">
						<thead>
					    	<tr>
						      	<th width="5%" scope="col">Type</th>
						      	<th width="10%" scope="col">Name</th>
						      	<th width="20%" scope="col">Email</th>
						      	<th width="12%" scope="col">MyReflet ID</th>
						      	<th width="8%" scope="col">Country</th>
						      	<th width="20%" scope="col">Verified Status</th>
						      	<th width="15%" scope="col">Created Date</th>
						      	<th width="10%" scope="col">Status</th>
						      	<th width="5%" scope="col">Action</th>
					    	</tr>
					  	</thead>
						<tbody id="subVerifierTble">
							<%if(sub_verifiers_list.data.length>0){%>
							<%sub_verifiers_list.data.forEach(sub_list=>{%>
								
						    <tr>
						      	<th scope="row">
							      	<div class="for-flex-align">
							      		<div class="checkbox">
								          	<label>
									           
									            <input type="checkbox" name="sub_ver_checkbox" value="<%=sub_list.invite_sub_id%>">
									            <span class="cr"><i class="cr-icon fa fa-check"></i></span>
									            <img class="profile-table for-square-img" src="../assets/images/icons/repersentative.png">
								         	 </label>
								        </div>
									</div>
						      	</th>
						      		<th scope="row">
							      	<div class="for-flex-align">
							      		<div class="checkbox">
								          	<label>
							      		     	<p class="line-hgt">
							      		     		<span class="font-w-600"><%=sub_list.full_name%></span>
							      		     	</p>
								         	 </label>
								        </div>
									</div>
						      	</th>
							    <td><%=sub_list.email%></td>
							    <td><%=sub_list.reflect_code%></td>
							    <td><%=sub_list.country_name%></td>
							    <td>
							    	<div>
										<span>
											<img src="../assets/images/icons/dashboard-assets/verified.png">
											Email
										</span>
										<!-- <span>
											<img src="../assets/images/icons/dashboard-assets/verificationpending.png">
											Phone
										</span> -->
									</div>
							    </td>
							    <td>
							    	<%=moment(sub_list.sub_createdAt).format("DD , MMM ,YYYY")%>
							    </td>
							    <td>
									<%if(sub_list.sub_veri_status=="inactive"){%>
										<div class="cancel-status">
											Deactive
										</div>
										<%}else{%>
											<div class="approved-status">
												Active
											</div>
											<%}%>
							    	
									
							    </td>
							    <td>
							      	<div class="dropdown-menu-new">
				                        <a class="nav-link dropdown-toggle" id="profileDropdown" href="#" data-toggle="dropdown" aria-expanded="false">
				                          <div class="doc-img">
									      		<img src="../assets/images/icons/dashboard-assets/menu.png">
									      	</div>
				                        </a>
				                        <div class="dropdown-menu" aria-labelledby="profileDropdown">
				                            <a class="dropdown-item" href="/sub_verifier_client?invite_sub_id=<%=sub_list.invite_sub_id%>" >
				                            	<img src="../assets/images/icons/dashboard-assets/view.png"> View
				                            </a>
											<!-- <a class="dropdown-item" href="">
												<img src="../assets/images/icons/verifier-home-assets/reject-grey.png"> Deactivate
											</a> -->
											<a class="dropdown-item" href="/delete_indi_sub_veri?status=deactivate&invite_sub_id=<%=sub_list.invite_sub_id%>">
												<img src="../assets/images/icons/verifier-home-assets/reject-grey.png"> Deactivate
											</a>
											<!-- <a class="dropdown-item" href="">
												<img src="../assets/images/icons/verifier-home-assets/delete-grey.png"> Delete
											</a>	 -->

											<a class="dropdown-item" href="/delete_indi_sub_veri?status=delete&invite_sub_id=<%=sub_list.invite_sub_id%>">
												<img src="../assets/images/icons/verifier-home-assets/reject-grey.png"> Delete
											</a>
				                        </div>
				                    </div>
						      	</td>
							</tr>
							<%})%>
							<%}%>
						    <!-- <tr>
						      	<th scope="row">
							      	<div class="for-flex-align">
							      		<div class="checkbox">
								          	<label>
									            <input type="checkbox" value="">
									            <span class="cr"><i class="cr-icon fa fa-check"></i></span>
									            <img class="profile-table for-square-img" src="../assets/images/icons/entity.png">
								         	 </label>
								        </div>
									</div>
						      	</th>
						      		<th scope="row">
							      	<div class="for-flex-align">
							      		<div class="checkbox">
								          	<label>
							      		     	<p class="line-hgt">
							      		     		<span class="font-w-600">Jack Ma</span> <br>
							      		     		25102
							      		     	</p>
								         	 </label>
								        </div>
									</div>
						      	</th>
							    <td>questglt@gmail.com</td>
							    <td>6464646894</td>
							    <td>China</td>
							    <td>
							    	<div>
										<span>
											<img src="../assets/images/icons/dashboard-assets/verified.png">
											Email
										</span>
										<span>
											<img src="../assets/images/icons/dashboard-assets/verificationpending.png">
											Phone
										</span>
									</div>
							    </td>
							    <td>
							    	July 10, 2019
							    </td>
							    <td>
							    	<div class="approved-status">
							    		Active
							    	</div>
							    </td>
							    <td>
							      	<div class="dropdown-menu-new">
				                        <a class="nav-link dropdown-toggle" id="profileDropdown" href="#" data-toggle="dropdown" aria-expanded="false">
				                          <div class="doc-img">
									      		<img src="../assets/images/icons/dashboard-assets/menu.png">
									      	</div>
				                        </a>
				                        <div class="dropdown-menu" aria-labelledby="profileDropdown">
				                            <a class="dropdown-item" href="sub-verifier-clients.php" >
				                            	<img src="../assets/images/icons/dashboard-assets/view.png"> View
				                            </a>
											<a class="dropdown-item" href="">
												<img src="../assets/images/icons/verifier-home-assets/reject-grey.png"> Deactivate
											</a>
											<a class="dropdown-item" href="">
												<img src="../assets/images/icons/verifier-home-assets/delete-grey.png"> Delete
											</a>	
				                        </div>
				                    </div>
						      	</td>
						    </tr> -->
						</tbody>
					</table>
					<div class="pagination-list for-user">
          
				     	<% if (sub_verifiers_list.totalPages > 0) { %>
				                       <ul class="pagination text-center">
					   <% if (sub_verifiers_list.currentPage == 1) { %>
						   <li class="disabled page-item"><a class="page-link">&lt;</a></li>
					   <% } else { %>
						   <li class="page-item"><a class="page-link" href="/sub_magage_verifier?page=1">&lt;</a></li>
					   <% } %>
				
				
				
					   <% var i = (Number(sub_verifiers_list.currentPage) > 5 ? Number(sub_verifiers_list.currentPage) - 4 : 1) %>
					   <% if (i !== 1) { %>
						   <!-- <li class="disabled"><a>...</a></li> -->
						   <li class="page-item disabled"><a class="page-link" >...</a></li>
					   <% } %>
					   <% for (; i <= (Number(sub_verifiers_list.currentPage) + 4) && i <= sub_verifiers_list.totalPages; i++) { %>
						   <% if (i == sub_verifiers_list.currentPage) { %>
							   <!-- <li class="active"><a><%= i %></a></li> -->
							   <li class="page-item active">
								 <a class="page-link" href="#"><%= i %><span class="sr-only">(sub_verifiers_list.currentPage)</span></a>
							   </li>
						   <% } else { %>
							   <li class="page-item"><a class="page-link" href="/sub_magage_verifier?page=<%= i %>"><%= i %></a></li>
						   <% } %>
						   <% if (i == Number(sub_verifiers_list.currentPage) + 4 && i < sub_verifiers_list.totalPages) { %>
							   <!-- <li class="disabled"><a>...</a></li> -->
							   <li class="page-item disabled"><a class="page-link" >...</a></li>
						   <% } %>
					   <% } %>
				
				
					   <% if (sub_verifiers_list.currentPage == sub_verifiers_list.totalPages) { %>                       
						   <li class="disabled page-item"><a class="page-link">&gt;</a></li>
					   <% } else { %>
						   <li><a class="page-link" href="/sub_magage_verifier?page=<%= sub_verifiers_list.totalPages %>">&gt;</a></li>
					   <% } %>
				
				         </ul>
				       <% } %>
				</div>
				
				
				 </div>
			</div>
		</div>
	</div>
</section>


<div class="modal fade field-edit-modal" id="add-new-sub-verifier-Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <div class="create-wallet-box">
			<div class="row align-item-center">
				<div class="col-xl-2 col-lg-3 col-md-3">
					<div>
						<img src="../assets/images/icons/createidentity-assets/updateinfo.png">
					</div>
				</div>
				<div class="col-xl-7 col-lg-7 col-md-7">
					<h5 class="heading-purple">Add New Sub-verifier</h5>
				</div>
			</div>
			<div class="row">
				<div class="col-xl-12 col-lg-12 col-md-12 m-auto">
                <form action="/submit_add_sub_verfier" method="POST">
					<div class="setup-inner-box for-protact">
						<div class="create-rflet-id-form">
						    <div class="form-group">
						    	<div class="input-group">
								   <select class="form-control" name="verifier_email" onchange="getEmailAndReflect(value)">
									  <option value="">Select by Email ID</option>
									  <%if(verifiersList.length>0){%>

									  <%verifiersList.forEach(verifier_emails=>{%>
										<option><%=verifier_emails.email%> - <%=verifier_emails.reflect_code%></option>
									 <% })%>
									 <% }%>
									  
								      <!-- <option>3</option>
								      <option>4</option>
								      <option>5</option> -->
								    </select>
								</div>
						    </div>
						    <p>This user does not exist on our platform, yor need to invite this user.</p>
						     <div class="form-group">
						    	<div class="input-group">
								  <input type="text" class="form-control" name="name" placeholder="Name">
								</div>
						    </div>
						    <div class="form-group">
								<div class="input-group">
								  <input type="email" name="email" class="form-control" placeholder="Email ID">
								</div>
							</div>
						</div>
						<div >
							<input type="hidden" name="reflect_id" id="reflect_id_form">
							<button type="submit" class="btn-common-new">Invite</button>
							<!-- <a   href="">Invite</a> -->
				<button type="button" class="btn-common-new" data-dismiss="modal" >Cancel</button>
<!-- 
							<a class="btn-common-new" href="">Cancel</a>
							<a class="btn-common-new"  href="">Cancel</a> -->

						</div>
					</div>
				</form>
				</div>
			 </div>
	 	  </div>
       </div>
    </div>
  </div>
</div>


<!-- <div class="modal fade field-edit-modal" id="add-new-sub-verifier2-Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <div class="create-wallet-box">
			<div class="row align-item-center">
				<div class="col-xl-2 col-lg-3 col-md-3">
					<div>
						<img src="../assets/images/icons/createidentity-assets/updateinfo.png">
					</div>
				</div>
				<div class="col-xl-7 col-lg-7 col-md-7">
					<h5 class="heading-purple">Add New Sub-verifier</h5>
				</div>
			</div>
			<div class="row">
				<div class="col-xl-12 col-lg-12 col-md-12 m-auto">
					<div class="setup-inner-box for-protact">
						<div class="create-rflet-id-form">
						    <div class="form-group">
						    	<div class="input-group">
								   <select class="form-control">
								      <option>Select by Email ID</option>
								      <option>2</option>
								      <option>3</option>
								      <option>4</option>
								      <option>5</option>
								    </select>
								</div>
						    </div>
						</div>
						<div class="personal-info-box table-responsive mt-30 table-dash">
					<table class="table">
						<thead>
					    	<tr>
						      	<th width="10%" scope="col">Type</th>
						      	<th width="10%" scope="col">Client</th>
						      	<th width="20%" scope="col">Email</th>
						      	<th width="10%" scope="col">Country</th>
						      	<th width="20%" scope="col">Verified Status</th>
					    	</tr>
					  	</thead>
						<tbody>
						    <tr>
						      	<th scope="row">
							      	<div class="for-flex-align">
							      		<div class="checkbox">
								          	<label>
									            <img class="profile-table for-square-img" src="../assets/images/icons/repersentative.png">
								         	 </label>
								        </div>
									</div>
						      	</th>
						      		<th scope="row">
							      	<div class="for-flex-align">
							      		<div class="checkbox">
								          	<label>
							      		     	<p class="line-hgt">
							      		     		<span class="font-w-600">Jack Ma</span> <br>
							      		     		25102
							      		     	</p>
								         	 </label>
								        </div>
									</div>
						      	</th>
							    <td>questglt@gmail.com</td>
							    <td>China</td>
							    <td>
							    	<div>
										<span>
											<img src="../assets/images/icons/dashboard-assets/verified.png">
											Email
										</span>
										<span>
											<img src="../assets/images/icons/dashboard-assets/verificationpending.png">
											Phone
										</span>
									</div>
							    </td>
						    </tr> 
						</tbody>
					</table>
				</div>
						<div >
							<a class="btn-common-new" href="">Submit</a>
							<a class="btn-common-new" href="">Cancel</a>
						</div>
					</div>
				</div>
			 </div>
	 	  </div>
       </div>
    </div>
  </div>
</div> -->




<%- include('../innerFooter')%>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>
<script>
$(document).ready( function () {
	// $('.table').DataTable();
} );
</script>
<script>
	function getEmailAndReflect(value){
		// alert(value)
		var reflectID=value.split("-")
		// alert(reflectID[0])
		// alert(reflectID[1])
// 
		$("#reflect_id_form").val(reflectID[1])
	}
</script>

<script>
	function checkedChangeStatus(value){
		// alert("request_ids")
             
		var invite_sub_id = [];
		$.each($("input[name='sub_ver_checkbox']:checked"), function(){
			invite_sub_id.push($(this).val());
			});
			console.log("request_ids",invite_sub_id)
			
			

			$.ajax({
                      type : 'POST',
                      url  : '/delete_sub_verifier',
					  data: {
						    invite_sub_id:JSON.stringify(invite_sub_id),
							 status :value
					        },
					  
						success: function(data) {
							alert(data)

							window.location.reload(true);
							
						}
			})
        

	}
	</script>


<script>
	$('.checkbox2').click(function() {
		// var userid = `${ userid}`
		// alert("hshbihbsduhbu") checkstatus
		$('#table_id').html(" ")

    
	var status_list = $('input[name=statusfilter]:checked').map(function(_, el) {
        return $(el).val();
	}).get();
	console.log("status list",status_list)
	// if(reflect_code_list[0]=='All')
	// {
	// 	window.location.reload(true);

	// }
	if(status_list[0]=='All')
	{
		window.location.reload(true);

	}
	// console.log("check box select value : ",reflect_code_list)  
	

	$.ajax({
                      type : 'POST',
                      url  : '/subverifer_filter',
					  data: {
						//   reflect_code_list:JSON.stringify(reflect_code_list),
						status_list: JSON.stringify(status_list),
						   },
					  
                        success: function(data) {
							
						//    var complaints=data
						//    var moment=data.moment
							// $("#all").hide();
							// alert(data)
						if(!data)
					    {
							$("#subVerifierTble").html("")

                            $('#subVerifierTble').append(`<td>No record found</td>`);

					     }
					   else{
						   
					// alert(data)

					$("#tablefilterid").html("")
					$("#tablefilterid").html(data)



	} 
	
			}                                                    
           
})
})
	</script>

<script>
	// $('.checkbox2').click(function() {
	function globalSearch(value2){
		// alert(value2)
		var value1=value2
	$.ajax({
                      type : 'POST',
                      url  : '/subverifer_search_filter',
					  data: {searchvalue:value1,
						   },
					  
                        success: function(data) {
							
						//    var complaints=data
						//    var moment=data.moment
							// $("#all").hide();
							// alert(data)
						if(!data)
					    {
							$("#subVerifierTble").html("")

                            $('#subVerifierTble').append(`<td>No record found</td>`);

					     }
					   else{
						   
					// alert(data)

					$("#tablefilterid").html("")
					$("#tablefilterid").html(data)



	} 
	
			}                                                    
           
  })
 }
</script>

<script>
	var reflect_id = "List";
function downloadpenlist(){
   html2canvas(document.getElementById('myTable3')).then(function(canvas) {
   var img = canvas.toDataURL("image/png");
   var doc = new jsPDF();
   doc.text(2,5, reflect_id);
   doc.addImage(img,'JPEG',-10,10);
   doc.save('verifier_desboard_list.pdf');
   });
 }
 function printpendiv(){
   
   var restorepage = $('body').html();
	 $('.nodata').hide();
	var printcontent = $('#myTable3').clone();
	$('body').empty().html(printcontent);
	window.print();
	$('body').html(restorepage);
  
 
 }
</script>