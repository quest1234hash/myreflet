<%-include('../innerHeader')%>

<style>
.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 140px;
  background-color: #555;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px;
  position: absolute;
  z-index: 1;
  bottom: 150%;
  left: 50%;
  margin-left: -75px;
  opacity: 0;
  transition: opacity 0.3s;
}

.tooltip .tooltiptext::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: #555 transparent transparent transparent;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}


.client-dash-sec .wallet-box{
        position: relative;
        
    }
    
    .balance-value.alert.alert-warning {
        padding: 2px 10px;
        border-radius: 5px !important;
        color: #fff;
        position: absolute;
        right: 0;
        top: -16px;
    }
    .alert-warning {
        color: #856404;
        background-color: #28a745  !important;
        border-color: #28a745  !important;
    }
    
    .balance-value2.alert.alert-warning2 {
        padding: 3px 10px;
        border-radius: 5px !important;
        color: #fff;
        position: absolute;
        right: 0;
        top: -16px;
    }
    .alert-warning2 {
        color: #856404;
        background-color: #f2081e  !important;
        border-color: #f2081e  !important;
    }
    
</style>
<section class="heading-sec">
	<div class="container">
		<div class="row align-item-center">
			<div class="col-lg-4 col-md-4 col-sm-4">
				<div class="main-heading-dash">
					<img src="../assets/images/icons/home-assets/wallet.png">
					<h4>Wallets</h4>
				</div>
			</div>
			<div class="col-lg-8 col-md-8 col-sm-8">
				<div class="text-right">
					<!-- <a class="btn-common-new" href="/get-create-wallet">Add New Wallet</a> -->
					<a class="btn-common-new" href="/create-wallets">Add New Wallet</a>
				</div>
			</div>
		</div>
	</div>
</section>

<section class="id-code-box-sec">
	<div class="container">
		<div class="row">
			<div class="col-md-12"> 
				<div class="white-box client-dash-sec">
					<div class="tab-content" id="myTabContent">
						<!-- digital wallets -->
					  <div class="tab-pane fade show active" id="dashtab1" role="tabpanel" aria-labelledby="dash-tab">
						 <% if(digitalArr.length>0){  %>
						<div class="row">
							<%  for(let i=0;i<digitalArr.length;i++){  %>
							<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
								<div class="white-box full-box wallet-box">
									<div class="row align-item-center">
									   <div class="col-xl-6 col-lg-12 col-md-12">

									   </div>
									   
										   <% if(digitalArr[i].isLinked=='yes'){ %>
											<div class="col-xl-12 col-lg-12 col-md-12 text-right">
											<label class="mb-0 balance-value ml-auto alert alert-warning" >Linked</label>
										</div>
											<% }else{ %>
												<div class="col-xl-12 col-lg-12 col-md-12 text-right">
													<label class="mb-0 balance-value2 ml-auto alert alert-warning2" >Not Linked</label>
											</div>
												<%  }%>
									
									</div>
									<div>
									<div class="row inner-box-id-code">
											<div class="col-md-4 p-0">
												<div class="for-flex-align">
													<img src="../assets/images/icons/home-assets/user.png">
													<p>Wallet ID</p>
												</div>
											</div>
											<div class="col-md-6 dubble-dot-after p-0">
												<p><%= digitalArr[i].walletId %></p>
											</div>
										</div>
										<div class="private-key-copy-box mt-15">
											<div class="form-group">
												<label>Public key</label>
												<div class="input-group mb-3">
													<input type="text" class="form-control" value="<%= digitalArr[i].walletAddress %>" id="wallet_addr<%=i %>" readonly>
												  <div class="input-group-append">
													<span class="tooltip">
													  <a class="btn-copy" href="javascript:void(0);"  onclick="myFunction1('<%=i %>')" onmouseout="outFunc('<%=i %>')"><img src="../assets/images/icons/createidentity-assets/copy.png">
														<span class="tooltiptext" id="myTooltip<%=i%>">Copy to clipboard</span>
													</a>
													</span>
												  </div>
												</div>
											</div>
										</div>
										<div class="row inner-box-id-code">
											<div class="col-md-4 p-0">
												<div class="for-flex-align">
													<img src="../assets/images/icons/home-assets/user.png">
													<p>MyReflet ID</p>
												</div>
											</div>
											<div class="col-md-6 dubble-dot-after p-0">
												<p><%= digitalArr[i].refletid %></p>
											</div>
										</div>
										<div class="row inner-box-id-code">
											<div class="col-md-4 p-0">
												<div class="for-flex-align">
													<img src="../assets/images/icons/wallet/ethereum.svg">
													<p>ETH Balance</p>
												</div>
											</div>
											<div class="col-md-6 dubble-dot-after p-0">
												<p>0 ETH</p>
											</div>
										</div>
										<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
											<a href="get_trans_history" onclick="location.href=this.href+'?wallet_type='+ `<%=encrypt(digitalArr[i].wallet_type) %>`+'&wallet_id='+`<%=encrypt(digitalArr[i].walletId) %>`;
												return false" class="btn-common-new"  style="padding: 4px 9px 3px 9px;"><i class="fas fa-eye"></i></a>
											</div>
									 </div>
								</div>
							</div>

							<% } %>
						  
						 </div>
						 <% } %>

						
						 
					  </div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<!-- <a onclick="shareit1()">Share on facebook</a>
 -->
<script type="text/javascript">
function shareit1(){

     var url="http://www.example.com"; //Set desired URL here
var img="http://www.example.com/example.jpg"; //Set Desired Image here
var totalurl=encodeURIComponent(url+'?img='+img);

window.open ('http://www.facebook.com/sharer.php?u='+totalurl,'','width=500, height=500, scrollbars=yes, resizable=no');
}
</script>
<%- include('../innerFooter')%>


<script type="text/javascript" src="../assets/js/custom_qr.min.js"></script>
<script type="text/javascript" src = "https://connect.facebook.net/en_US/sdk.js#version=v2.2&appId=myAppId&xfbml=true&autoLogAppEvents=true"></script>

<script>
	var text_share,rowno;
	function show_share_modal(text_share,rowno)
	{
		//alert(text_share);
		text_share=text_share;
		var whatsup_url='https://api.whatsapp.com/send?text='+encodeURI('Please send ether to wallet address '+text_share);
		//var facebook_url='https://m.facebook.com/sharer.php?u=';
		// var instagram_url='https://api.facebook.com/send?text='+encodeURI('Please send ether to wallet address ',+text_share);
		// var facebook_url=encodeURIComponent("Hey,I scored 4500"); window.open("https://www.facebook.com/sharer.php?u=http://192.168.1.137:3001/&description="+text_share);
	// var facebook_url="https://www.facebook.com/sharer.php?u=http://192.168.1.137:3001/&description="+text_share;
	
 // location.href = ('https://www.facebook.com/sharer/sharer.php?u=codepen.io/InicianteGit1/full/eGvvBp/');
  // })
		$('#whatsup-url').attr('href',whatsup_url);
		// $('#instagram-url').attr('href',instagram_url);


		// $('#facebook-url').attr('href',facebook_url);

		// alert("wallet add"+text_share);
		$('#wallet-qrcode').html('');
		create_qrcode('wallet-qrcode',text_share,200,200);



		$('#share-Modal').modal('show');
	}


$(function(){

	var i=1;
	$('.qrcode').each(function(){


		var wallet_add=$('#wallet_addr'+i).val();


		// var wallet_div=$('#qrcode'+i).val();

		create_qrcode('qrcode'+i,wallet_add,110,110);

		// var qr_src=$('#qrcode'+i).html();

         //console.log("qr src",qr_src);
		i++;
	});

    

})

var qrdiv,qrtext;
function create_qrcode(qrdiv,qrtext,qrwidth,qrheight)
{

		var qrcode = new QRCode(qrdiv, {
	        text:qrtext,
		    width:qrwidth,
		    height:qrheight,
		    colorDark : "#000000",
		    colorLight : "#ffffff",
		    correctLevel : QRCode.CorrectLevel.H
	   });



       
		// var file = dataURLtoFile(base64_string,'qrcode.png');


		// $.ajax({
  //           url:""+authToken,
  //           type:"POST",
  //           data:fd,
  //           processData:false,
  //           contentType:false,
  //           cache:false,
  //           success:function(data){
  //               console.log("success " + data);
  //           },
  //           error:function(shr,status,data){
  //               console.log("error " + data + " Status " + shr.status);
  //           },
  //           complete:function(){
  //               console.log("Posted to facebook");
  //           }
  //       });
    		
}

// qrcode.clear(); // clear the code.
// qrcode.makeCode("http://naver.com"); // make another code.
// document.body.addEventListener('click', ()=>{
//             qrcode.clear(); 
//             qrcode.makeCode("http://google.ca/"); 
//         })

function shareit()
{

	var scored = document.getElementById('wallet-qrcode').innerHTML;

     var desc=encodeURIComponent(scored); window.open("https://www.facebook.com/sharer.php?u=http://165.22.209.72:3008/&description="+desc);


	// var authToken="EAACbCf6ZCDywBANgEtJuo5LBr4OhQaP7IrFioNzNgxktS3MZBu2tmpJKuwxkLHnl9SFHtSOM04jo3Ad0f18P1FCxFDYLAJNAzSM8kTZCJrCEN02lZAKaTZCONGHhlaDLL7juJZBGS6B1fiEHLTFJ7dG0lnGDktiDtv8Pojf85hfCvzTEZB9QZAkFoH9ADAfsmS4g4VWRXbISSGdUWvTRfiztGVy152wRwovMrTFqdtomvAZDZD";
 //    // var canvas = document.getElementById("c");
 //    // var imageData  = canvas.toDataURL("image/png");
 //    // try {
 //    //     blob = dataURItoBlob(imageData);
 //    // }
 //    // catch(e) {
 //    //     console.log(e);
 //    // }
 //    var base64_string=$('#wallet-qrcode').find('img').attr('src');

 //    var file = dataURLtoFile(base64_string,'qrcode.png');
    
 //    var fd = new FormData();
 //    fd.append("access_token",authToken);
 //    fd.append("source",file);
 //    fd.append("message","Photo Text");
 //    try {
 //        $.ajax({
 //            url:"https://graph.facebook.com/me/photos?access_token="+authToken,
 //            type:"POST",
 //            data:fd,
 //            processData:false,
 //            contentType:false,
 //            cache:false,
 //            success:function(data){
 //                console.log("success " + data);
 //            },
 //            error:function(shr,status,data){
 //                console.log("error " + data + " Status " + shr.status);
 //            },
 //            complete:function(){
 //                console.log("Posted to facebook");
 //            }
 //        });
 //    }
 //    catch(e) 
 //    {
 //        console.log(e);
 //    }
}

function shareit_data()
{
	var base64_string=$('#wallet-qrcode').find('img').attr('src');

	var file = dataURLtoFile(base64_string,'qrcode.png');
    // console.log(file);

    $.ajax({
            url:""+authToken,
            type:"POST",
            data:fd,
            processData:false,
            contentType:false,
            cache:false,
            success:function(data){
                console.log("success " + data);
            },
            error:function(shr,status,data){
                console.log("error " + data + " Status " + shr.status);
            },
            complete:function(){
                console.log("Posted to facebook");
            }
        });
    			

	//console.log(base64_string);
	// var img = document.createElement("img");
	// img.width = "250px";
	// img.height = "250px";
	// img.src = base64_string;
	// var preview = document.getElementById("img_preview");
	// preview.appendChild(img);

	//console.log('img',img);
}


function dataURLtoFile(dataurl,filename) {
 
	var arr = dataurl.split(','),
	    mime = arr[0].match(/:(.*?);/)[1],
	    bstr = atob(arr[1]), 
	    n = bstr.length, 
	    u8arr = new Uint8Array(n);
	    
	while(n--){
	    u8arr[n] = bstr.charCodeAt(n);
	}

	return new File([u8arr], filename, {type:mime});
}

</script>

<script type="text/javascript">
// function shareit(){
// 	var url=window.location.href; //Set desired URL here
// 	var img=$('#wallet-qrcode').find('img').attr('src'); //Set Desired Image here
// 	//var totalurl=encodeURIComponent(url+'?img='+img);
// 	var totalurl='http://192.168.1.137:3001/assets/images/icons/wallet/fb.png';

// 	//alert(img);

// 	// alert("url"+totalurl);

// 	 window.open ('http://www.facebook.com/sharer.php?u='+totalurl,'','width=500, height=500, scrollbars=yes, resizable=no');

// }

//  function shareit() {
//      var u=$('#wallet-qrcode').find('img').attr('src');

//      var blob_url=dataURItoBlob(u);

//      alert(blob_url);
//      // t=document.title;
//     t='img';
//     // window.open('http://www.facebook.com/sharer.php?u='+encodeURIComponent(u)+'&t='+encodeURIComponent(t),'sharer','toolbar=0,status=0,width=626,height=436');return false;
// }


function dataURItoBlob(dataURI) {
  // convert base64 to raw binary data held in a string
  // doesn't handle URLEncoded DataURIs - see SO answer #6850276 for code that does this
  var byteString = atob(dataURI.split(',')[1]);

  // separate out the mime component
  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]

  // write the bytes of the string to an ArrayBuffer
  var ab = new ArrayBuffer(byteString.length);

  // create a view into the buffer
  var ia = new Uint8Array(ab);

  // set the bytes of the buffer to the correct values
  for (var i = 0; i < byteString.length; i++) {
      ia[i] = byteString.charCodeAt(i);
  }

  // write the ArrayBuffer to a blob, and you're done
  var blob = new Blob([ab], {type: mimeString});
  return blob;

}

</script>

<script type="text/javascript">
	function fbShare() {
  var windowHeight = 350,
  windowWidth = 520,  
      alignTop = (screen.height / 2) - (windowHeight / 2),
      alignLeft = (screen.width / 2) - (windowWidth / 2),

      url='http://165.22.209.72:3001/',
	title='send ether',
	descr='Please send ether to wallet address '+text_share ,
      facebookShareUrl = 'https://www.facebook.com/sharer.php?s=100&p[title]=' + title + '&p[summary]=' + descr + '&p[url]=' + url
  
  // how to open a window - https://www.w3schools.com/jsref/met_win_open.asp
  window.open( facebookShareUrl, "","top=" + alignTop + ",left=" + alignLeft + ",width=" + windowWidth +",height=" + windowHeight);
}
</script>



<script type="text/javascript">
  $(document).ready(function(){
                  $('.loader').hide()
				  $('.loader-box').hide();

  });
  
</script>


<script>
     function fbs_click(TheImg) {
     u=TheImg.src;
     // t=document.title;
    t=TheImg.getAttribute('alt');
    window.open('http://www.facebook.com/sharer.php?u='+encodeURIComponent(u)+'&t='+encodeURIComponent(t),'sharer','toolbar=0,status=0,width=626,height=436');return false;
}
</script>


<script type="text/javascript">
	function copy_address(i_val) {
	  var copyText = document.getElementById("wallet_addr"+i_val);
	  if($('#wallet_addr').val() !="")
	  {
	  copyText.select();
	  document.execCommand("copy");
	  alert("Wallet address is copied.");
	  }  
	}  
</script>


 <script>
function myFunction1(i_val) {
  var copyText = document.getElementById("wallet_addr"+i_val);
  copyText.select();
  copyText.setSelectionRange(0, 99999);
  document.execCommand("copy");
  
  var tooltip = document.getElementById("myTooltip"+i_val);
  tooltip.innerHTML = "Copied";
	// tooltip.innerHTML = "Copied: " + copyText.value;

}

function outFunc(i_val) {
  var tooltip = document.getElementById("myTooltip"+i_val);
  tooltip.innerHTML = "Copy to clipboard";
}
</script>